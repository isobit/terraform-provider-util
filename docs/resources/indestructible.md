---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "util_indestructible Resource - util"
subcategory: ""
description: |-
  The util_indestructible resource creates a node in the resource
  graph that cannot be destroyed unless the allow_destroy attribute
  is set to true in the state. This provides a workaround to a
  well-known shortcoming https://github.com/hashicorp/terraform/issues/17599
  of the prevent_destroy lifecycle attribute by exploiting
  dependency order to prevent the destruction of resources that are dependencies
  of the indestructible resource, since it must be destroyed before the dependencies
  are.
---

# util_indestructible (Resource)

The `util_indestructible` resource creates a node in the resource
graph that cannot be destroyed unless the `allow_destroy` attribute
is set to `true` in the state. This provides a workaround to a
[well-known shortcoming](https://github.com/hashicorp/terraform/issues/17599)
of the `prevent_destroy` lifecycle attribute by exploiting
dependency order to prevent the destruction of resources that are dependencies
of the indestructible resource, since it must be destroyed before the dependencies
are.

## Example Usage

```terraform
# Example of a resource that will be protected from destruction.
resource "terraform_data" "protected" {}

# This indestructible resources protects the resource from destruction by
# depending on it; if terraform tries to destroy the proected resource, it will
# destroy util_indestructible.this first, which will fail unless allow_destroy
# is set to true.
resource "util_indestructible" "this" {
	# The protected value can be any attribute of the protected resource that
	# would change under replacement. The resource can be also be protected using
	# an explicit "depends_on", but in that case the resource also needs to have
	# "prevent_destroy = true" in the lifecycle configuration to prevent
	# destruction during replacement. Using protected_value simultaneously
	# implies the dependency relationship, and protects against destruction
	# during replacement by causing the indestructible resource itself to also be
	# replaced when the protected resource is replaced.
	protected_value = terraform_data.protected.id
	# Custom messages are optional, but helpful to explain why it is important to
	# avoid destroying the protected resources.
	error_message = "Destroying terraform_data.protected will cause major issues, please don't destroy it!"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `allow_bypass` (Boolean) Whether to allow destruction when `bypass_indestructible` is set on the provider.
- `allow_destroy` (Boolean) Whether to allow destruction.
- `error_message` (String) Additional message to include in the error message when attempting to destroy when `allow_destroy` is `false`.
- `protected_value` (Dynamic) The protected value can be any attribute of the protected resource that would change under replacement. The resource can be also be protected using an explicit `depends_on`, but in that case the resource also needs to have `prevent_destroy = true` in the lifecycle configuration to prevent destruction during replacement. Using protected_value simultaneously implies the dependency relationship, and protects against destruction during replacement by causing the indestructible resource itself to also be replaced when the protected resource is replaced.
